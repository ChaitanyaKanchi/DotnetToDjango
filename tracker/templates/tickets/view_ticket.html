{% extends 'shared/base_dashboard.html' %}
{% load static %}

{% block title %}View Ticket #{{ ticket.id }}{% endblock %}

{% block extra_css %}
<style>
    input, select, textarea {
        max-width: 100%;
    }
    .commentbox {
        border: 1px solid #ccc;
        padding: 5px;
    }
    .highlight > img {
        height: auto;
        max-width: 100% !important;
        vertical-align: bottom;
    }
    /* ...existing styles... */
</style>
{% endblock %}

{% block sidebar_content %}
<div class="mt-5 hidden-xs hidden_md"></div>
<div class="px-2">
    <div class="my-3">
        <label>Assignee: <span class="text-danger">*</span></label>
        <div class="ticket_select">
            <select id="ddlassignee" class="form-control">
                <option value="">-- Select --</option>
            </select>
        </div>
        <span id="spnddlassignee" class="text-danger" style="display:none;"></span>
    </div>

    <div class="my-3">
        <label>Priority</label>
        <div class="ticket_select">
            <select id="ddlpriority" class="form-control">
                <option value="">-- Select --</option>
            </select>
        </div>
        <span id="spnpriority" class="text-danger" style="display:none;"></span>
    </div>

    <div class="my-3">
        <label>Brand</label>
        <div class="ticket_select">
            <select id="ddlbrand" class="form-control"></select>
        </div>
    </div>

    <div class="my-3">
        <label>CCs</label>
        <div class="ticket_input">
            <input type="text" id="txtccs" class="form-control" data-role="tagsinput">
        </div>
        <span id="spntxtccs" class="text-danger" style="display:none;"></span>
    </div>
</div>
{% endblock %}

{% block main_content %}
<div class="card border-light shadow-sm pb-3 m-3">
    <div class="top_section mt-1 d-flex shadow-sm align-items-start justify-content-between">
        <div class="p-4 h5 m-0 text-primary">Ticket #{{ ticket.id }}</div>
        <div class="p-4">
            <span class="badge bg-{{ ticket.get_status_display|lower }}">{{ ticket.get_status_display }}</span>
        </div>
    </div>

    <div class="ticket-details p-4">
        <h4>{{ ticket.subject }}</h4>
        <div class="ticket-meta text-muted mb-3">
            <small>Created by {{ ticket.created_by.username }} on {{ ticket.created_at|date:"M d, Y H:i" }}</small>
            <br>
            <small>Priority: {{ ticket.priority }}</small>
            {% if ticket.brand %}
            <br>
            <small>Brand: {{ ticket.brand }}</small>
            {% endif %}
        </div>

        <div class="ticket-description mb-4">
            {{ ticket.description|safe }}
        </div>

        {% if attachments %}
        <div class="attachments mb-4">
            <h5>Attachments</h5>
            <ul class="list-unstyled">
                {% for attachment in attachments %}
                <li>
                    <a href="{{ attachment.file.url }}" target="_blank">
                        <i class="fas fa-paperclip"></i> {{ attachment.file_name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {% if comments %}
        <div class="comments">
            <h5>Comments</h5>
            {% for comment in comments %}
            <div class="comment card mb-3">
                <div class="card-body">
                    <div class="comment-meta text-muted mb-2">
                        <small>{{ comment.user.username }} commented on {{ comment.created_at|date:"M d, Y H:i" }}</small>
                    </div>
                    {{ comment.comment|safe }}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'assets/Scripts/ckeditor/ckeditor.js' %}"></script>
<script>
// ...existing JavaScript code...
</script>
{% endblock %}
